using System.Collections.Generic;
using System.Linq;
using System.Text.RegularExpressions;
using TMPro;
using UnityEngine;

public class CubeDescriptionView : ChristofellElement {
    public TextMeshProUGUI title;
    public TextDescription textDescriptionPrefab;
    public LaTeXDescription laTeXDescriptionPrefab;
    public IParameterDescription[] parameters = new IParameterDescription[0];
    private void Awake() {
        App.spaceChanged.listOfHandlers += (object sender, SpaceChangedArgs e) => {
            title.text = e.tensorProperties.Name;
            title.autoSizeTextContainer = true;
            foreach (var item in parameters) {
                item.Destroy();
            }
            parameters = e.tensorProperties.Parameters
                .Concat(e.tensorProperties.Coordinates)
                .Where(parameter => parameter.Description.Length > 0)
                .Select((parameter, i) => {
                    IParameterDescription asset;
                    try {
                        string text = GetParameter(parameter.LaTeX);
                        asset = Instantiate(textDescriptionPrefab, transform);
                        asset.Parameter = text;
                    } catch {
                        asset = Instantiate(laTeXDescriptionPrefab, transform);
                        asset.Parameter = parameter.LaTeX;
                    }
                    asset.Description = parameter.Description;
                    asset.RectTransform.Translate(Vector3.down * textDescriptionPrefab.RectTransform.rect.height * i);
                    return asset;
                }).ToArray();
        };
    }

    private string GetParameter(string laTeX) {
        string temp = laTeX + "";
        Regex[] filters = new [] {
            new Regex(@"(\\not)?[\\][a-zA-Z]+(\{[a-zA-Z0-9]*\})?"),
            new Regex(@"\^[a-zA-Z0-9]"),
            new Regex(@"_[a-zA-Z0-9]"),
            new Regex(@"[a-zA-Z0-9]"),
        };
        foreach (Regex filter in filters) {
            temp = filter.Replace(temp, (a) => LaTeXToUnicode[a.Value]);
        }
        return temp;
    }

    private Dictionary<string, string> LaTeXToUnicode = new Dictionary<string, string> {
        [@"\alpha"] = @"Î±",
        [@"\Alpha"] = @"Î‘",
        [@"\beta"] = @"Î²",
        [@"\Beta"] = @"Î’",
        [@"\gamma"] = @"Î³",
        [@"\Gamma"] = @"Î“",
        [@"\delta"] = @"Î´",
        [@"\Delta"] = @"Î”",
        [@"\epsilon"] = @"Ïµ",
        [@"\Epsilon"] = @"Î•",
        [@"\zeta"] = @"Î¶",
        [@"\Zeta"] = @"Î–",
        [@"\eta"] = @"Î·",
        [@"\Eta"] = @"Î—",
        [@"\theta"] = @"Î¸",
        [@"\Theta"] = @"Î˜",
        [@"\iota"] = @"Î¹",
        [@"\Iota"] = @"I",
        [@"\kappa"] = @"Îº",
        [@"\Kappa"] = @"Îš",
        [@"\lambda"] = @"Î»",
        [@"\Lambda"] = @"Î›",
        [@"\mu"] = @"Î¼",
        [@"\Mu"] = @"Îœ",
        [@"\nu"] = @"Î½",
        [@"\Nu"] = @"Î",
        [@"\xi"] = @"Î¾",
        [@"\Xi"] = @"Î",
        [@"\omicron"] = @"Î¿",
        [@"\Omicron"] = @"ÎŸ",
        [@"\pi"] = @"Ï€",
        [@"\Pi"] = @"Î ",
        [@"\rho"] = @"Ï",
        [@"\Rho"] = @"Î¡",
        [@"\sigma"] = @"Ïƒ",
        [@"\Sigma"] = @"Î£",
        [@"\tau"] = @"Ï„",
        [@"\Tau"] = @"Î¤",
        [@"\upsilon"] = @"Ï…",
        [@"\Upsilon"] = @"Î¥",
        [@"\phi"] = @"Ï•",
        [@"\Phi"] = @"Î¦",
        [@"\chi"] = @"Ï‡",
        [@"\Chi"] = @"Î§",
        [@"\psi"] = @"Ïˆ",
        [@"\Psi"] = @"Î¨",
        [@"\omega"] = @"Ï‰",
        [@"\Omega"] = @"Î©",
        [@"\varepsilon"] = @"Îµ",
        [@"\varkappa"] = @"Ï°",
        [@"\varphi"] = @"Ï†",
        [@"\varpi"] = @"Ï–",
        [@"\varrho"] = @"Ï±",
        [@"\varsigma"] = @"Ï‚",
        [@"\vartheta"] = @"Ï‘",
        [@"\neq"] = @"â‰ ",
        [@"\equiv"] = @"â‰¡",
        [@"\not\equiv"] = @"â‰¢",
        [@"\leq"] = @"â‰¤",
        [@"\geq"] = @"â‰¥",
        [@"\leqq"] = @"â‰¦",
        [@"\geqq"] = @"â‰§",
        [@"\lneqq"] = @"â‰¨",
        [@"\gneqq"] = @"â‰©",
        [@"\leqslant"] = @"â©½",
        [@"\geqslant"] = @"â©¾",
        [@"\ll"] = @"â‰ª",
        [@"\gg"] = @"â‰«",
        [@"\nless"] = @"â‰®",
        [@"\ngtr"] = @"â‰¯",
        [@"\nleq"] = @"â‰°",
        [@"\ngeq"] = @"â‰±",
        [@"\lessequivlnt"] = @"â‰²",
        [@"\greaterequivlnt"] = @"â‰³",
        [@"\prec"] = @"â‰º",
        [@"\succ"] = @"â‰»",
        [@"\preccurlyeq"] = @"â‰¼",
        [@"\succcurlyeq"] = @"â‰½",
        [@"\precapprox"] = @"â‰¾",
        [@"\succapprox"] = @"â‰¿",
        [@"\nprec"] = @"âŠ€",
        [@"\nsucc"] = @"âŠ",
        [@"\sim"] = @"âˆ¼",
        [@"\not\sim"] = @"â‰",
        [@"\simeq"] = @"â‰ƒ",
        [@"\not\simeq"] = @"â‰„",
        [@"\backsim"] = @"âˆ½",
        [@"\lazysinv"] = @"âˆ¾",
        [@"\wr"] = @"â‰€",
        [@"\cong"] = @"â‰…",
        [@"\not\cong"] = @"â‰‡",
        [@"\approx"] = @"â‰ˆ",
        [@"\not\approx"] = @"â‰‰",
        [@"\approxeq"] = @"â‰Š",
        [@"\approxnotequal"] = @"â‰†",
        [@"\tildetrpl"] = @"â‰‹",
        [@"\allequal"] = @"â‰Œ",
        [@"\asymp"] = @"â‰",
        [@"\doteq"] = @"â‰",
        [@"\doteqdot"] = @"â‰‘",
        [@"\lneq"] = @"âª‡",
        [@"\gneq"] = @"âªˆ",
        [@"\preceq"] = @"âª¯",
        [@"\succeq"] = @"âª°",
        [@"\precneqq"] = @"âªµ",
        [@"\succneqq"] = @"âª¶",
        [@"#Sets and"] = @"Logic",
        [@"\emptyset"] = @"âˆ…",
        [@"\in"] = @"âˆˆ",
        [@"\notin	âˆ‰"] = @"",
        [@"\not\in"] = @"âˆ‰",
        [@"\ni"] = @"âˆ‹",
        [@"\not\ni"] = @"âˆŒ",
        [@"\subset"] = @"âŠ‚",
        [@"\subseteq"] = @"âŠ†",
        [@"\not\subset"] = @"âŠ„",
        [@"\not\subseteq"] = @"âŠˆ",
        [@"\supset"] = @"âŠƒ",
        [@"\supseteq"] = @"âŠ‡",
        [@"\not\supset"] = @"âŠ…",
        [@"\not\supseteq"] = @"âŠ‰",
        [@"\subsetneq"] = @"âŠŠ",
        [@"\supsetneq"] = @"âŠ‹",
        [@"\exists"] = @"âˆƒ",
        [@"\nexists	âˆ„"] = @"",
        [@"\not\exists"] = @"âˆ„",
        [@"\forall"] = @"âˆ€",
        [@"\aleph"] = @"â„µ",
        [@"\beth"] = @"â„¶",
        [@"\neg"] = @"Â¬",
        [@"\wedge"] = @"âˆ§",
        [@"\vee"] = @"âˆ¨",
        [@"\veebar"] = @"âŠ»",
        [@"\land"] = @"âˆ§",
        [@"\lor"] = @"âˆ¨",
        [@"\top"] = @"âŠ¤",
        [@"\bot"] = @"âŠ¥",
        [@"\cup"] = @"âˆª",
        [@"\cap"] = @"âˆ©",
        [@"\bigcup"] = @"â‹ƒ",
        [@"\bigcap"] = @"â‹‚",
        [@"\setminus"] = @"âˆ–",
        [@"\therefore"] = @"âˆ´",
        [@"\because"] = @"âˆµ",
        [@"\Box"] = @"â–¡",
        [@"\models"] = @"âŠ¨",
        [@"\vdash"] = @"âŠ¢",
        [@"\rightarrow	â†’"] = @"",
        [@"\Rightarrow"] = @"â‡’",
        [@"\leftarrow	â†"] = @"",
        [@"\Leftarrow"] = @"â‡",
        [@"\uparrow	â†‘"] = @"",
        [@"\Uparrow"] = @"â‡‘",
        [@"\downarrow	â†“"] = @"",
        [@"\Downarrow"] = @"â‡“",
        [@"\nwarrow	â†–"] = @"",
        [@"\nearrow"] = @"â†—",
        [@"\searrow	â†˜"] = @"",
        [@"\swarrow"] = @"â†™",
        [@"\mapsto"] = @"â†¦",
        [@"\to"] = @"â†’",
        [@"\leftrightarrow	â†”"] = @"",
        [@"\hookleftarrow"] = @"â†©",
        [@"\Leftrightarrow"] = @"â‡”",
        [@"\rightarrowtail	â†£"] = @"",
        [@"\leftarrowtail"] = @"â†¢",
        [@"\twoheadrightarrow	â† "] = @"",
        [@"\twoheadleftarrow"] = @"â†",
        [@"\hookrightarrow	â†ª"] = @"",
        [@"\hookleftarrow"] = @"â†©",
        [@"\rightsquigarrow"] = @"â‡",
        [@"\rightleftharpoons	â‡Œ"] = @"",
        [@"\leftrightharpoons"] = @"â‡‹",
        [@"\rightharpoonup	â‡€"] = @"",
        [@"\rightharpoondown"] = @"â‡",
        [@"\times"] = @"Ã—",
        [@"\div"] = @"Ã·",
        [@"\infty"] = @"âˆ",
        [@"\nabla"] = @"âˆ‡",
        [@"\partial"] = @"âˆ‚",
        [@"\sum"] = @"âˆ‘",
        [@"\prod"] = @"âˆ",
        [@"\coprod"] = @"âˆ",
        [@"\int"] = @"âˆ«",
        [@"\iint"] = @"âˆ¬",
        [@"\iiint"] = @"âˆ­",
        [@"\iiiint"] = @"â¨Œ",
        [@"\oint"] = @"âˆ®",
        [@"\surfintegral"] = @"âˆ¯",
        [@"\volintegral"] = @"âˆ°",
        [@"\Re"] = @"â„œ",
        [@"\Im"] = @"â„‘",
        [@"\wp"] = @"â„˜",
        [@"\mp"] = @"âˆ“",
        [@"\langle"] = @"âŸ¨",
        [@"\rangle"] = @"âŸ©",
        [@"\lfloor"] = @"âŒŠ",
        [@"\rfloor"] = @"âŒ‹",
        [@"\lceil"] = @"âŒˆ",
        [@"\rceil"] = @"âŒ‰",
        [@"\mathbb{a}"] = @"ğ•’",
        [@"\mathbb{A}"] = @"ğ”¸",
        [@"\mathbb{b}"] = @"ğ•“",
        [@"\mathbb{B}"] = @"ğ”¹",
        [@"\mathbb{c}"] = @"ğ•”",
        [@"\mathbb{C}"] = @"â„‚",
        [@"\mathbb{d}"] = @"ğ••",
        [@"\mathbb{D}"] = @"ğ”»",
        [@"\mathbb{e}"] = @"ğ•–",
        [@"\mathbb{E}"] = @"ğ”¼",
        [@"\mathbb{f}"] = @"ğ•—",
        [@"\mathbb{F}"] = @"ğ”½",
        [@"\mathbb{g}"] = @"ğ•˜",
        [@"\mathbb{G}"] = @"ğ”¾",
        [@"\mathbb{h}"] = @"ğ•™",
        [@"\mathbb{H}"] = @"â„",
        [@"\mathbb{i}"] = @"ğ•š",
        [@"\mathbb{I}"] = @"ğ•€",
        [@"\mathbb{j}"] = @"ğ•›",
        [@"\mathbb{J}"] = @"ğ•",
        [@"\mathbb{k}"] = @"ğ•œ",
        [@"\mathbb{K}"] = @"ğ•‚",
        [@"\mathbb{l}"] = @"ğ•",
        [@"\mathbb{L}"] = @"ğ•ƒ",
        [@"\mathbb{m}"] = @"ğ•",
        [@"\mathbb{M}"] = @"ğ•„",
        [@"\mathbb{n}"] = @"ğ•Ÿ",
        [@"\mathbb{N}"] = @"â„•",
        [@"\mathbb{o}"] = @"ğ• ",
        [@"\mathbb{O}"] = @"ğ•†",
        [@"\mathbb{p}"] = @"ğ•¡",
        [@"\mathbb{P}"] = @"â„™",
        [@"\mathbb{q}"] = @"ğ•¢",
        [@"\mathbb{Q}"] = @"â„š",
        [@"\mathbb{r}"] = @"ğ•£",
        [@"\mathbb{R}"] = @"â„",
        [@"\mathbb{s}"] = @"ğ•¤",
        [@"\mathbb{S}"] = @"ğ•Š",
        [@"\mathbb{t}"] = @"ğ•¥",
        [@"\mathbb{T}"] = @"ğ•‹",
        [@"\mathbb{u}"] = @"ğ•¦",
        [@"\mathbb{U}"] = @"ğ•Œ",
        [@"\mathbb{v}"] = @"ğ•§",
        [@"\mathbb{V}"] = @"ğ•",
        [@"\mathbb{x}"] = @"ğ•©",
        [@"\mathbb{X}"] = @"ğ•",
        [@"\mathbb{y}"] = @"ğ•ª",
        [@"\mathbb{Y}"] = @"ğ•",
        [@"\mathbb{z}"] = @"ğ•«",
        [@"\mathbb{Z}"] = @"â„¤",
        [@"\mathbb{0}"] = @"ğŸ˜",
        [@"\mathbb{1}"] = @"ğŸ™",
        [@"\mathbb{2}"] = @"ğŸš",
        [@"\mathbb{3}"] = @"ğŸ›",
        [@"\mathbb{4}"] = @"ğŸœ",
        [@"\mathbb{5}"] = @"ğŸ",
        [@"\mathbb{6}"] = @"ğŸ",
        [@"\mathbb{7}"] = @"ğŸŸ",
        [@"\mathbb{8}"] = @"ğŸ ",
        [@"\mathbb{9}"] = @"ğŸ¡",
        [@"\mathfrak{a}"] = @"ğ”",
        [@"\mathfrak{A}"] = @"ğ”„",
        [@"\mathfrak{b}"] = @"ğ”Ÿ",
        [@"\mathfrak{B}"] = @"ğ”…",
        [@"\mathfrak{c}"] = @"ğ” ",
        [@"\mathfrak{C}"] = @"â„­",
        [@"\mathfrak{d}"] = @"ğ”¡",
        [@"\mathfrak{D}"] = @"ğ”‡",
        [@"\mathfrak{e}"] = @"ğ”¢",
        [@"\mathfrak{E}"] = @"ğ”ˆ",
        [@"\mathfrak{f}"] = @"ğ”£",
        [@"\mathfrak{F}"] = @"ğ”‰",
        [@"\mathfrak{g}"] = @"ğ”¤",
        [@"\mathfrak{G}"] = @"ğ”Š",
        [@"\mathfrak{h}"] = @"ğ”¥",
        [@"\mathfrak{H}"] = @"â„Œ",
        [@"\mathfrak{i}"] = @"ğ”¦",
        [@"\mathfrak{I}"] = @"â„‘",
        [@"\mathfrak{j}"] = @"ğ”§",
        [@"\mathfrak{J}"] = @"ğ”",
        [@"\mathfrak{k}"] = @"ğ”¨",
        [@"\mathfrak{K}"] = @"ğ”",
        [@"\mathfrak{l}"] = @"ğ”©",
        [@"\mathfrak{L}"] = @"ğ”",
        [@"\mathfrak{m}"] = @"ğ”ª",
        [@"\mathfrak{M}"] = @"ğ”",
        [@"\mathfrak{n}"] = @"ğ”«",
        [@"\mathfrak{N}"] = @"ğ”‘",
        [@"\mathfrak{o}"] = @"ğ”¬",
        [@"\mathfrak{O}"] = @"ğ”’",
        [@"\mathfrak{p}"] = @"ğ”­",
        [@"\mathfrak{P}"] = @"ğ”“",
        [@"\mathfrak{q}"] = @"ğ”®",
        [@"\mathfrak{Q}"] = @"ğ””",
        [@"\mathfrak{r}"] = @"ğ”¯",
        [@"\mathfrak{R}"] = @"â„œ",
        [@"\mathfrak{s}"] = @"ğ”°",
        [@"\mathfrak{S}"] = @"ğ”–",
        [@"\mathfrak{t}"] = @"ğ”±",
        [@"\mathfrak{T}"] = @"ğ”—",
        [@"\mathfrak{u}"] = @"ğ”²",
        [@"\mathfrak{U}"] = @"ğ”˜",
        [@"\mathfrak{v}"] = @"ğ”³",
        [@"\mathfrak{V}"] = @"ğ”™",
        [@"\mathfrak{x}"] = @"ğ”µ",
        [@"\mathfrak{X}"] = @"ğ”›",
        [@"\mathfrak{y}"] = @"ğ”¶",
        [@"\mathfrak{Y}"] = @"ğ”œ",
        [@"\mathfrak{z}"] = @"ğ”·",
        [@"\mathfrak{Z}"] = @"â„¨",
        [@"_0"] = @"â‚€",
        [@"^0"] = @"â°",
        [@"_1"] = @"â‚",
        [@"^1"] = @"Â¹",
        [@"_2"] = @"â‚‚",
        [@"^2"] = @"Â²",
        [@"_3"] = @"â‚ƒ",
        [@"^3"] = @"Â³",
        [@"_4"] = @"â‚„",
        [@"^4"] = @"â´",
        [@"_5"] = @"â‚…",
        [@"^5"] = @"âµ",
        [@"_6"] = @"â‚†",
        [@"^6"] = @"â¶",
        [@"_7"] = @"â‚‡",
        [@"^7"] = @"â·",
        [@"_8"] = @"â‚ˆ",
        [@"^8"] = @"â¸",
        [@"_9"] = @"â‚‰",
        [@"^9"] = @"â¹",
        [@"_+"] = @"â‚Š",
        [@"^+"] = @"âº",
        [@"_-"] = @"â‚‹",
        [@"^-"] = @"â»",
        [@"_("] = @"â‚",
        [@"^("] = @"â½",
        [@"_)"] = @"â‚",
        [@"^)"] = @"â¾",
        [@"_a"] = @"â‚",
        [@"^a"] = @"áµƒ",
        [@"^b"] = @"áµ‡",
        [@"^c"] = @"á¶œ",
        [@"^d"] = @"áµˆ",
        [@"_e"] = @"â‚‘",
        [@"^e"] = @"áµ‰",
        [@"^f"] = @"á¶ ",
        [@"^g"] = @"áµ",
        [@"_h"] = @"â‚•",
        [@"^h"] = @"Ê°",
        [@"_i"] = @"áµ¢",
        [@"^i"] = @"â±",
        [@"_j"] = @"â±¼",
        [@"^j"] = @"Ê²",
        [@"_k"] = @"â‚–",
        [@"^k"] = @"áµ",
        [@"_l"] = @"â‚—",
        [@"^l"] = @"Ë¡",
        [@"_m"] = @"â‚˜",
        [@"^m"] = @"áµ",
        [@"_n"] = @"â‚™",
        [@"^n"] = @"â¿",
        [@"_o"] = @"â‚’",
        [@"^o"] = @"áµ’",
        [@"_p"] = @"â‚š",
        [@"^p"] = @"áµ–",
        [@"_r"] = @"áµ£",
        [@"^r"] = @"Ê³",
        [@"_s"] = @"â‚›",
        [@"^s"] = @"Ë¢",
        [@"_t"] = @"â‚œ",
        [@"^t"] = @"áµ—",
        [@"_u"] = @"áµ¤",
        [@"^u"] = @"áµ˜",
        [@"_v"] = @"áµ¥",
        [@"^v"] = @"áµ›",
        [@"^w"] = @"Ê·",
        [@"_x"] = @"â‚“",
        [@"^x"] = @"Ë£",
        [@"^y"] = @"Ê¸",
        [@"^z"] = @"á¶»",
        [@"\mp"] = @"âˆ“",
        [@"\dotplus"] = @"âˆ”",
        [@"\bullet"] = @"âˆ™",
        [@"\cdot"] = @"â‹…",
        [@"\oplus"] = @"âŠ•",
        [@"\ominus"] = @"âŠ–",
        [@"\otimes"] = @"âŠ—",
        [@"\oslash"] = @"âŠ˜",
        [@"\odot"] = @"âŠ™",
        [@"\circ"] = @"âˆ˜",
        [@"\surd"] = @"âˆš",
        [@"\propto"] = @"âˆ",
        [@"\angle"] = @"âˆ ",
        [@"\measuredangle"] = @"âˆ¡",
        [@"\sphericalangle"] = @"âˆ¢",
        [@"\mid"] = @"âˆ£",
        [@"\nmid	"] = @"âˆ¤",
        [@"\not\mid"] = @"âˆ¤",
        [@"\parallel"] = @"âˆ¥",
        [@"\nparallel	"] = @"âˆ¦",
        [@"\not\parallel"] = @"âˆ¦",
        [@"\flat"] = @"â™­",
        [@"\natural"] = @"â™®",
        [@"\sharp"] = @"â™¯",
        ["a"] = "a",
        ["b"] = "b",
        ["c"] = "c",
        ["d"] = "d",
        ["e"] = "e",
        ["f"] = "f",
        ["g"] = "g",
        ["h"] = "h",
        ["i"] = "i",
        ["j"] = "j",
        ["k"] = "k",
        ["l"] = "l",
        ["m"] = "m",
        ["n"] = "n",
        ["o"] = "o",
        ["p"] = "p",
        ["q"] = "q",
        ["r"] = "r",
        ["s"] = "s",
        ["t"] = "t",
        ["u"] = "u",
        ["v"] = "v",
        ["w"] = "w",
        ["x"] = "x",
        ["y"] = "y",
        ["z"] = "z",
        ["A"] = "A",
        ["B"] = "B",
        ["C"] = "C",
        ["D"] = "D",
        ["E"] = "E",
        ["F"] = "F",
        ["G"] = "G",
        ["H"] = "H",
        ["I"] = "I",
        ["J"] = "J",
        ["K"] = "K",
        ["L"] = "L",
        ["M"] = "M",
        ["N"] = "N",
        ["O"] = "O",
        ["P"] = "P",
        ["Q"] = "Q",
        ["R"] = "R",
        ["S"] = "S",
        ["T"] = "T",
        ["U"] = "U",
        ["V"] = "V",
        ["W"] = "W",
        ["X"] = "X",
        ["Y"] = "Y",
        ["Z"] = "Z",
    };
}